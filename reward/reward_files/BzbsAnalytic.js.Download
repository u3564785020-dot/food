function getBzbsProfile() {
    var profileCookie;
    var name = "BzbsUser=";
    var decodedCookie = decodeURIComponent(document.cookie);
    var ca = decodedCookie.split(';');
    for (var i = 0; i < ca.length; i++) {
        var c = ca[i];
        while (c.charAt(0) == ' ') {
            c = c.substring(1);
        }
        if (c.indexOf(name) == 0) {
            profileCookie = c.substring(name.length, c.length);
        }
    }

    var profile;
    try {
        profile = JSON.parse(profileCookie);
    } catch (e) { }

    return profile;
};

function BzbsAnalyticInitial(dimensionKey, webVersion, bzbsAnalyticUrl, bzbsAnalyticId) {
    //the event occurred
    /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
    /* When user login #https://developer.matomo.org/guides/tracking-javascript-guide
        *
        * _paq.push(['setUserId', 'USER_ID_HERE']);
        *
        * */
    _paq.push(['setCustomDimension', dimensionKey, webVersion]);

    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function () {
        //U is Bzbs Analytic Url;
        var u = bzbsAnalyticUrl;
        _paq.push(['setTrackerUrl', u + '/matomo.php']);
        _paq.push(['setSiteId', bzbsAnalyticId]);
        console.log(bzbsAnalyticId);
        var d = document, g = d.createElement('script'), s = d.getElementsByTagName('script')[0];
        g.type = 'text/javascript'; g.async = true; g.defer = true; g.src = u + '/matomo.js'; s.parentNode.insertBefore(g, s);
    })();

    window.BzbsAnalytic = {
        "trackEvent": function (category, action, label) {
            var profile = getBzbsProfile();
            if (profile && profile.userId)
                _paq.push(['setUserId', profile.userId]);


            _paq.push(['trackEvent', category, action, label]);
        },
        "trackScreen": function (name) {
            var profile = getBzbsProfile();
            if (profile && profile.userId)
                _paq.push(['setUserId', profile.userId]);

            _paq.push(['setDocumentTitle', name]);
            _paq.push(['trackPageView']);
        },
    };
}
